<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Intro to STMO - Firefox Data Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../dtmo.css">
        
        <link rel="stylesheet" href="../mermaid.css">
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "../";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="../introduction.html">Firefox Data Documentation</a></li><li><a href="../concepts/reporting_a_problem.html"><strong aria-hidden="true">1.</strong> Reporting a problem</a></li><li><a href="../concepts/terminology.html"><strong aria-hidden="true">2.</strong> Terminology</a></li><li><a href="../concepts/getting_started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li><a href="../concepts/analysis_intro.html"><strong aria-hidden="true">3.1.</strong> Analysis Quick Start</a></li><li><a href="../concepts/choosing_a_dataset.html"><strong aria-hidden="true">3.2.</strong> Choosing a Dataset</a></li><li><a href="../tools/stmo.html" class="active"><strong aria-hidden="true">3.3.</strong> Intro to STMO</a></li><li><a href="../concepts/analysis_gotchas.html"><strong aria-hidden="true">3.4.</strong> Common Analysis Gotchas</a></li><li><a href="../concepts/sql_optimization.html"><strong aria-hidden="true">3.5.</strong> Optimizing Queries</a></li><li><a href="../concepts/review.html"><strong aria-hidden="true">3.6.</strong> Getting Review</a></li><li><a href="../datasets/new_data.html"><strong aria-hidden="true">3.7.</strong> Collecting New Data</a></li></ol></li><li><a href="../tools/index.html"><strong aria-hidden="true">4.</strong> Tools</a></li><li><ol class="section"><li><a href="../tools/projects.html"><strong aria-hidden="true">4.1.</strong> Project Glossary</a></li><li><a href="../concepts/pipeline/data_pipeline.html"><strong aria-hidden="true">4.2.</strong> Overview of Mozilla's Data Pipeline</a></li><li><ol class="section"><li><a href="../concepts/pipeline/data_pipeline_detail.html"><strong aria-hidden="true">4.2.1.</strong> In-depth Data Pipeline Detail</a></li><li><a href="../concepts/pipeline/http_edge_spec.html"><strong aria-hidden="true">4.2.2.</strong> HTTP Edge Server Specification</a></li><li><a href="../concepts/pipeline/event_pipeline.html"><strong aria-hidden="true">4.2.3.</strong> Event Pipeline Detail</a></li></ol></li><li><a href="../tools/interfaces.html"><strong aria-hidden="true">4.3.</strong> Analysis Interfaces</a></li><li><a href="../tools/spark.html"><strong aria-hidden="true">4.4.</strong> Custom analysis with Spark</a></li><li><a href="../concepts/sql_style.html"><strong aria-hidden="true">4.5.</strong> SQL Style Guide</a></li></ol></li><li><a href="../cookbooks/index.html"><strong aria-hidden="true">5.</strong> Cookbooks</a></li><li><ol class="section"><li><a href="../tools/alerts.html"><strong aria-hidden="true">5.1.</strong> Alerts</a></li><li><a href="../cookbooks/parquet.html"><strong aria-hidden="true">5.2.</strong> Working with Parquet Data on ATMO Clusters</a></li><li><a href="../cookbooks/create_a_dataset.html"><strong aria-hidden="true">5.3.</strong> Creating a custom Re:dash dataset</a></li><li><a href="../cookbooks/new_ping.html"><strong aria-hidden="true">5.4.</strong> Sending a Custom Ping</a></li><li><a href="../cookbooks/hll_zeppelin.html"><strong aria-hidden="true">5.5.</strong> Using HyperLogLog in Zeppelin</a></li><li><a href="../cookbooks/dataset_specific.html"><strong aria-hidden="true">5.6.</strong> Dataset Specific</a></li><li><ol class="section"><li><a href="../cookbooks/longitudinal_examples.html"><strong aria-hidden="true">5.6.1.</strong> Longitudinal Examples</a></li><li><a href="../cookbooks/crash_pings.html"><strong aria-hidden="true">5.6.2.</strong> Working with Crash Pings</a></li></ol></li><li><a href="../cookbooks/realtime.html"><strong aria-hidden="true">5.7.</strong> Real-time</a></li><li><ol class="section"><li><a href="../cookbooks/realtime_analysis_plugin.html"><strong aria-hidden="true">5.7.1.</strong> Creating a Real-time Analysis Plugin</a></li><li><a href="../cookbooks/view_pings_cep.html"><strong aria-hidden="true">5.7.2.</strong> Seeing Your Own Pings</a></li><li><a href="../tools/cep_matcher.html"><strong aria-hidden="true">5.7.3.</strong> CEP Matcher</a></li></ol></li><li><a href="../cookbooks/metrics.html"><strong aria-hidden="true">5.8.</strong> Metrics</a></li><li><ol class="section"><li><a href="../cookbooks/active_dau.html"><strong aria-hidden="true">5.8.1.</strong> Active DAU Definition</a></li><li><a href="../cookbooks/retention.html"><strong aria-hidden="true">5.8.2.</strong> Retention Analysis</a></li><li class="spacer"></li></ol></li></ol></li><li><a href="../datasets/reference.html"><strong aria-hidden="true">6.</strong> Dataset Reference</a></li><li><ol class="section"><li><a href="../datasets/pings.html"><strong aria-hidden="true">6.1.</strong> Pings</a></li><li><a href="../datasets/derived.html"><strong aria-hidden="true">6.2.</strong> Derived Datasets</a></li><li><ol class="section"><li><a href="../datasets/batch_view/addons/reference.html"><strong aria-hidden="true">6.2.1.</strong> Addons</a></li><li><a href="../datasets/mozetl/churn/reference.html"><strong aria-hidden="true">6.2.2.</strong> Churn</a></li><li><a href="../datasets/batch_view/client_count_daily/reference.html"><strong aria-hidden="true">6.2.3.</strong> Client Count Daily</a></li><li><a href="../datasets/batch_view/client_count/reference.html"><strong aria-hidden="true">6.2.4.</strong> Client Count</a></li><li><a href="../datasets/batch_view/clients_daily/reference.html"><strong aria-hidden="true">6.2.5.</strong> Clients Daily</a></li><li><a href="../datasets/batch_view/crash_aggregates/reference.html"><strong aria-hidden="true">6.2.6.</strong> Crash Aggregate</a></li><li><a href="../datasets/batch_view/crash_summary/reference.html"><strong aria-hidden="true">6.2.7.</strong> Crash Summary</a></li><li><a href="../datasets/batch_view/cross_sectional/reference.html"><strong aria-hidden="true">6.2.8.</strong> Cross Sectional</a></li><li><a href="../datasets/streaming/error_aggregates/reference.html"><strong aria-hidden="true">6.2.9.</strong> Error Aggregates</a></li><li><a href="../datasets/batch_view/events/reference.html"><strong aria-hidden="true">6.2.10.</strong> Events</a></li><li><a href="../datasets/batch_view/first_shutdown_summary/reference.html"><strong aria-hidden="true">6.2.11.</strong> First Shutdown Summary</a></li><li><a href="../datasets/batch_view/longitudinal/reference.html"><strong aria-hidden="true">6.2.12.</strong> Longitudinal</a></li><li><a href="../datasets/batch_view/main_summary/reference.html"><strong aria-hidden="true">6.2.13.</strong> Main Summary</a></li><li><a href="../datasets/batch_view/new_profile/reference.html"><strong aria-hidden="true">6.2.14.</strong> New Profile</a></li><li><a href="../datasets/batch_view/retention/reference.html"><strong aria-hidden="true">6.2.15.</strong> Retention</a></li><li><a href="../datasets/other/socorro_crash/reference.html"><strong aria-hidden="true">6.2.16.</strong> Socorro Crash Reports</a></li><li><a href="../datasets/other/ssl/reference.html"><strong aria-hidden="true">6.2.17.</strong> SSL Ratios (public)</a></li><li><a href="../datasets/batch_view/sync_summary/reference.html"><strong aria-hidden="true">6.2.18.</strong> Sync Summary</a></li><li><a href="../datasets/batch_view/update/reference.html"><strong aria-hidden="true">6.2.19.</strong> Update</a></li></ol></li><li><a href="../tools/experiments.html"><strong aria-hidden="true">6.3.</strong> Experimental Datasets</a></li><li><ol class="section"><li><a href="../datasets/shield.html"><strong aria-hidden="true">6.3.1.</strong> Accessing Shield Study data</a></li></ol></li><li><a href="../datasets/search.html"><strong aria-hidden="true">6.4.</strong> Search Datasets</a></li><li><ol class="section"><li><a href="../datasets/mozetl/search_aggregates/reference.html"><strong aria-hidden="true">6.4.1.</strong> Search Aggregates</a></li><li><a href="../datasets/mozetl/search_clients_daily/reference.html"><strong aria-hidden="true">6.4.2.</strong> Search Clients Daily</a></li></ol></li><li><a href="../datasets/other.html"><strong aria-hidden="true">6.5.</strong> Other Datasets</a></li><li><ol class="section"><li><a href="../datasets/other/hgpush/reference.html"><strong aria-hidden="true">6.5.1.</strong> hgpush</a></li></ol></li><li><a href="../datasets/obsolete.html"><strong aria-hidden="true">6.6.</strong> Obsolete Datasets</a></li><li><ol class="section"><li><a href="../datasets/obsolete/heavy_users/reference.html"><strong aria-hidden="true">6.6.1.</strong> Heavy Users</a></li><li class="spacer"></li></ol></li></ol></li><li><a href="../concepts/index.html"><strong aria-hidden="true">7.</strong> Telemetry Behavior Reference</a></li><li><ol class="section"><li><a href="../concepts/profile/index.html"><strong aria-hidden="true">7.1.</strong> Profile Behavior</a></li><li><ol class="section"><li><a href="../concepts/profile/profile_creation.html"><strong aria-hidden="true">7.1.1.</strong> Profile Creation</a></li><li><a href="../concepts/profile/realworldusage.html"><strong aria-hidden="true">7.1.2.</strong> Real World Usage</a></li><li><a href="../concepts/profile/profilehistory.html"><strong aria-hidden="true">7.1.3.</strong> Profile History</a></li><li class="spacer"></li></ol></li></ol></li><li><a href="../meta/index.html"><strong aria-hidden="true">8.</strong> About this Documentation</a></li><li><ol class="section"><li><a href="../meta/contributing.html"><strong aria-hidden="true">8.1.</strong> Contributing</a></li><li><a href="../meta/structure.html"><strong aria-hidden="true">8.2.</strong> Structure</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Firefox Data Documentation</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#introduction" id="introduction"><h2>Introduction</h2></a>
<p>STMO is shorthand for
<a href="https://sql.telemetry.mozilla.org"><code>sql.telemetry.mozilla.org</code></a>, an installation
of the excellent <a href="https://redash.io/">Re:dash</a> data analysis and dashboarding
tool that has been customized and configured for use with a number of the
Firefox organization's data sets. As the name and URL imply, effective use of
this tool requires familiarity with the
<a href="https://en.wikipedia.org/wiki/SQL">SQL</a> query language, with which all of the
tool's data extraction and analysis are performed.</p>
<a class="header" href="#concepts" id="concepts"><h2>Concepts</h2></a>
<p>There are three building block from which analyses in STMO are constructed:
queries, visualizations, and dashboards.</p>
<a class="header" href="#queries" id="queries"><h4>Queries</h4></a>
<p>STMO's basic unit of analysis is the query. A query is a block of SQL code that
extracts and (optionally) transforms data from a single data source. Queries
can vary widely in complexity. Some queries are trivial one liners
(e.g. <code>SELECT * FROM tablename LIMIT 10</code>), while others are many pages long,
small programs in their own right.</p>
<p>The raw output from a query is tabular data, where each row is one set of
return values for the query's output columns. A query can be run manually or it
can be specified to have a refresh schedule, where it will execute
automatically after a specified interval of time.</p>
<a class="header" href="#visualizations" id="visualizations"><h4>Visualizations</h4></a>
<p>Tabular data is great, but rarely is a grid of values the best way to make
sense of your data. Each query can be associated with multiple visualizations,
each visualization rendering the extracted data in some more useful
format. There are many visualization types, including charts (line, bar, area,
pie, etc.), counters, maps, pivot tables, and more. Each visualization type
provides a set of configuration parameters that allow you to specify how to map
from the raw query output to the desired visualization. Some visualization types
make demands of the query output; a map visualization requires each row to contain
a longitude value and a latitude value, for instance.</p>
<a class="header" href="#dashboards" id="dashboards"><h4>Dashboards</h4></a>
<p>A dashboard is a collection of visualizations, combined into a single visual
presentation for convenient perusal. A dashboard is decoupled from any
particular queries. While it is possible to include multiple visualizations
from a single query in one dashboard, it is not required; users can add any
visualizations they can access to the dashboards they create.</p>
<a class="header" href="#data-sources" id="data-sources"><h2>Data Sources</h2></a>
<p>SQL provides the ability to extract and manipulate the data, but you won't get
very far without having some familiarity with what data is actually available,
and how that data is structured. Each query in STMO is associated with exactly
one data source, and you have to know ahead of time which data source contains
the information that you need. One of the most commonly used data sources is
called <em>Athena</em> (referring to Amazon's <a href="https://aws.amazon.com/athena/">Athena</a>
query service, on which it is built), which contains most of the data that is
obtained from telemetry pings received from Firefox clients. The <em>Athena</em>
source is slowly replacing the <em>Presto</em> data source. <em>Presto</em> contains all of
the data that's exposed via <em>Athena</em> and more, but returns query results much
more slowly.</p>
<p>Other available data sources include <em>Crash DB</em>, <em>Tiles</em>, <em>Sync Stats</em>, <em>Push</em>,
<em>Test Pilot</em>, <em>ATMO</em>, and even a <em>Re:dash metadata</em> which connects to STMO's
own Re:dash database. You can learn more about the available data sets and how
to find the one that's right for you on the <a href="../concepts/choosing_a_dataset.html">Choosing a
dataset</a> page. If you have data set
questions, or would like to know if specific data is or can be made available
in STMO, please inquire in the <code>#datapipeline</code> or <code>#datatools</code> channels on
<code>irc.mozilla.org</code>.</p>
<a class="header" href="#creating-an-example-dashboard" id="creating-an-example-dashboard"><h2>Creating an Example Dashboard</h2></a>
<p>The rest of this document will take you through the process of creating a
simple dashboard using STMO.</p>
<a class="header" href="#creating-a-query" id="creating-a-query"><h4>Creating A Query</h4></a>
<p>We start by creating a query. Our first query will count the number of client
ids that we have coming from each country, for the top N countries. Clicking on
the 'New Query' button near the top left of the site will bring you to the
query editing page:</p>
<p><img src="../assets/STMO_screenshots/new_query.png" alt="New Query Page" title="New Query page" /></p>
<p>For this (and most queries where we're counting distinct client IDs) we'll want
to use the <a href="../datasets/batch_view/client_count_daily/reference.html"><code>client_count_daily</code> data
set</a> that is generated from
Firefox telemetry pings.</p>
<ul>
<li>
<p>Check if the data set is in Athena</p>
<p>As mentioned above, Athena is faster than Presto, but not all data sets are
yet available in Athena. We can check to see if the one we want is available
in the by typing <code>client_count_daily</code> into the &quot;Search schema...&quot;  search box above
the schema browser interface to the left of the main query edit box. As of
this writing, alas, there are no matches for <code>client_count_daily</code>, which means this
data set is not available in <em>Athena</em>.</p>
</li>
<li>
<p>Verify the data set exists in Presto</p>
<p>It's not in Athena, so now we should check to see if it's in Presto. If you
click on the 'Data Source' drop-down and change the selection from 'Athena' to
'Presto' (with <code>client_count_daily</code> still populating the filter input), you should
see that there is, in fact, a <code>client_count_daily</code> data set (showing up as
<code>default.client_count_daily</code>), as well as versioned <code>client_count_daily</code> data
sets (showing up as <code>default.client_count_daily_v&lt;VERSION&gt;</code>).</p>
</li>
<li>
<p>Introspect the available columns</p>
<p>Clicking on the <code>default.client_count_daily</code> in the schema browser exposes the
columns that are available in the data set. Two of the columns are of
interest to us for this query: <code>country</code> (for obvious reasons) and <code>hll</code>.</p>
</li>
</ul>
<p>The <code>hll</code> column bears some explanation. <code>hll</code> stands for
<a href="https://en.wikipedia.org/wiki/HyperLogLog">HyperLogLog</a>, a sophisticated
algorithm that allows for the counting of extremely high numbers of items,
sacrificing a small amount of accuracy in exchange for using much less memory
than a simple counting structure. The <code>client_count_daily</code> data set uses the <code>hll</code>
column for all of its counting functionality. Converting the <code>hll</code> value back
to a regular numeric value requires the use of the following magic SQL
incantation:</p>
<p><code>cardinality(merge(cast(hll as HLL)))</code></p>
<p>So a query that extracts all of the unique country values and the count for
each one, sorted from highest count to lowest count looks like this:</p>
<pre><code class="language-sql">SELECT country,
       cardinality(merge(cast(hll AS HLL))) AS client_count
FROM client_count_daily
GROUP BY 1
ORDER BY 2 DESC
</code></pre>
<p>If you type that into the main query edit box and then click on the &quot;Execute&quot;
button, you should see a blue bar appear below the edit box containing the text
&quot;Executing query...&quot; followed by a timer indicating how long the query has been
running. After a reasonable (for some definition of &quot;reasonable&quot;, usually about
one to two minutes) amount of time the query should complete, resulting in a
table showing a client count value for each country. Congratulations, you've
just created and run your first STMO query!</p>
<p>Now would be a good time to click on the large &quot;New Query&quot; text near the top of
the page; it should turn into an edit box, allowing you to rename the
query. For this exercise, you should use a unique prefix (such as your name)
for your query name, so it will be easy to find your query later; I used
<code>rmiller:Top Countries</code>.</p>
<a class="header" href="#creating-a-visualization" id="creating-a-visualization"><h4>Creating A Visualization</h4></a>
<p>Now that the query is created, we'll want to provide a simple
visualization. The table with results from the first query execution should be
showing up underneath the query edit box. Next to the <code>TABLE</code> heading should be
another heading entitled <code>+NEW VISUALIZATION</code>.</p>
<p><img src="../assets/STMO_screenshots/new_visualization.png" alt="New Visualization" title="New Visualization" /></p>
<p>Clicking on the <code>+NEW VISUALIZATION</code> link should bring you to the
&quot;Visualization Editor&quot; screen, where you can specify a visualization name (&quot;Top
Countries bar chart&quot;), a chart type (&quot;Bar&quot;), an x-axis column (<code>country</code>), and
a y-axis column (<code>client_count</code>).:</p>
<p><img src="../assets/STMO_screenshots/vis_editor.png" alt="Visualization Editor" title="Visualization Editor" /></p>
<p>After the <code>GENERAL</code> settings have been specified, we'll want to tweak a few
more settings on the <code>X AXIS</code> tab. You'll want to click on this tab and then
change the 'Scale' setting to 'Category', and un-check the 'Sort Values'
check-box to allow the query's sort order to take precedence:</p>
<p><img src="../assets/STMO_screenshots/x_axis_editor.png" alt="Visualization X Axis" title="Visualization X Axis" /></p>
<a class="header" href="#a-note-about-limits" id="a-note-about-limits"><h4>A Note About Limits</h4></a>
<p>Once you save the visualization settings and return to the query source page,
you should have a nice bar graph near the bottom of the page. You may notice,
however, that the graph has quite a long tail. Rather than seeing <em>all</em> of
the countries, it might be nicer to only see the top 20. We can do this by adding
a <code>LIMIT</code> clause to the end of our query:</p>
<p><code>SELECT country, cardinality(merge(cast(hll AS HLL))) AS client_count FROM client_count_daily GROUP BY 1 ORDER BY 2 DESC LIMIT 20</code></p>
<p>If you edit the query to add a limit clause and again hit the 'Execute' button,
you should get a new bar graph that only shows the 20 countries with the
highest number of unique clients. In this case, the full data set has
approximately 250 return values, and so limiting the result count improves
readability. In other cases, however, an unlimited query might return thousands
or even millions of rows. When those queries are run, readability is not the
only problem; queries that return millions of rows can tax the system, failing
to return the desired results, and negatively impacting the performance of all
of the other users of the system. Thus, a very important warning:</p>
<p><strong>ALL QUERIES SHOULD INCLUDE A &quot;LIMIT&quot; STATEMENT BY DEFAULT!</strong></p>
<p>You should be in the habit of adding a &quot;LIMIT 100&quot; clause to the end of all new
queries, to prevent your query from returning a gigantic data set that causes
UI and performance problems. You may learn that the total result set is small
enough that the limit is unnecessary, but unless you're certain that is the
case specifying an explicit LIMIT helps prevent unnecessary issues.</p>
<a class="header" href="#query-parameters" id="query-parameters"><h4>Query Parameters</h4></a>
<p>We got our chart under control by adding a &quot;LIMIT 20&quot; clause at the end. But
what if we only want the top 10? Or maybe sometimes we want to see the top 30?
We don't always know how many results our users will want. Is it possible to
allow users to specify how many results they want to see?</p>
<p>As you've probably guessed, I wouldn't be asking that question if the answer
wasn't &quot;yes&quot;. STMO allows queries to accept user arguments by the use of double
curly-braces around a variable name. So our query now becomes the following:</p>
<p><code>SELECT country, cardinality(merge(cast(hll AS HLL))) AS client_count FROM client_count_daily GROUP BY 1 ORDER BY 2 DESC LIMIT {{country_count}}</code></p>
<p>Once you replace the hard coded limit value with <code>{{country_count}}</code> you should
see an input field show up directly above the bar chart. If you enter a numeric
value into this input box and click on 'Execute' the query will run with the
specified limit. Clicking on the 'Save' button will then save the query, using
the entered parameter value as the default.</p>
<a class="header" href="#creating-a-dashboard" id="creating-a-dashboard"><h4>Creating A Dashboard</h4></a>
<p>Now we can create a dashboard to display our visualization. Do this by clicking
on the 'Dashboards' drop-down near the top left of the page, and then clicking
the 'New Dashboard' option. Choose a name for your dashboard, and you will be
brought to a mostly empty page. Clicking on the '...' button near the top right
of the page will give you the option to 'Add Widget'. This displays the
following dialog:</p>
<p><img src="../assets/STMO_screenshots/add_widget.png" alt="Add Widget" title="Add Widget" /></p>
<p>The &quot;Search a query by name&quot; field is where you can enter in the unique prefix
used in your query name to find the query you created. This will not yet work,
however, because your query isn't published. Publishing a query makes it show
up in searches and on summary pages. Since this is only an exercise, we won't
want to leave our query published, but it must be published briefly in order to
add it to our dashboard. You can publish your query by returning to the query
source page and clicking the &quot;Publish&quot; button near the top right of the screen.</p>
<p>Once your query is published, it should show up in the search results when you
type your unique prefix into the &quot;Search a query by name&quot; field on the &quot;Add
Widget&quot; dialog. When you select your query, a new &quot;Choose Visualization&quot;
drop-down will appear, allowing you to choose which of the query's
visualizations to use. Choose the bar chart you created and then click on the
&quot;Add to Dashboard&quot; button. Voila! Now your dashboard should have a bar chart,
and you should be able to edit the <code>country_count</code> value and click the refresh
button to change the number of countries that show up on the chart.</p>
<a class="header" href="#completing-the-dashboard" id="completing-the-dashboard"><h4>Completing the Dashboard</h4></a>
<p>A dashboard with just one graph is a bit sad, so let's flesh it out by adding a
handful of additional widgets. We're going to create three more queries, each
with a very similar bar chart. The text of the queries will be provided here,
but creating the queries and the visualizations and wiring them up to the
dashboard will be left as an exercise to the user. The queries are as follows:</p>
<ul>
<li>
<p>Top OSes (recommended <code>os_count</code> value == 6)</p>
<p><code>SELECT os, cardinality(merge(cast(hll AS HLL))) AS client_count FROM client_count_daily GROUP BY 1 ORDER BY 2 DESC LIMIT {{os_count}}</code></p>
</li>
<li>
<p>Channel Counts</p>
<p><code>SELECT normalized_channel AS channel, cardinality(merge(cast(hll AS HLL))) AS client_count FROM client_count_daily GROUP BY 1 ORDER BY 2 DESC</code></p>
</li>
<li>
<p>App Version Counts (recommended <code>app_version_count value</code> == 20)</p>
<p><code>SELECT app_name, app_version, cardinality(merge(cast(hll AS HLL))) AS client_count FROM client_count_daily GROUP BY 1, 2 ORDER BY 3 DESC LIMIT {{app_version_count}}</code></p>
</li>
</ul>
<p>Creating bar charts for these queries and adding them to the original dashboard
can result in a dashboard resembling this:</p>
<p><img src="../assets/STMO_screenshots/finished_dashboard.png" alt="Completed Dashboard" title="Completed Dashboard" /></p>
<p>Some final notes to help you create your dashboards:</p>
<ul>
<li>
<p>Don't forget that you'll need to publish each of your queries before you can
add its visualizations to your dashboard.</p>
</li>
<li>
<p>Similarly, it's a good idea to un-publish any test queries after you've used
them in a dashboard so as not to permanently pollute everyone's search results
with your tests and experiments. Queries that are the result of actual
work-related analysis should usually remain published, so others can see and
learn from them.</p>
</li>
<li>
<p>The 'Firefox' label on the 'App Version counts' graph is related to the use
of the 'Group by' visualization setting. I encourage you to experiment with
the use of 'Group by' in your graphs to learn more about how this can be
used.</p>
</li>
<li>
<p>This tutorial has only scratched the surface of the wide variety of very
sophisticated visualizations supported by STMO. You can see a great many much
more sophisticated queries and dashboards by browsing around and exploring
the work that has been published by others.</p>
</li>
<li>
<p>The <a href="https://redash.io/help/">Re:dash help center</a> is useful for further deep
diving into Re:dash and all of its capabilities.</p>
</li>
</ul>
<a class="header" href="#prototyping-queries" id="prototyping-queries"><h4>Prototyping Queries</h4></a>
<p>Sometimes you want to start working on your query before the data is available.
You can do this with most of the data sources by selecting a static test data
set, then working with it as usual. You can also use this method to explore
how a given SQL backend behaves.</p>
<p>Note that <code>UNION ALL</code> will retain duplicate rows while <code>UNION</code> will discard them.</p>
<p>Here are a couple of examples:</p>
<p><strong>Simple three-column test dataset</strong></p>
<pre><code class="language-sql">WITH test AS (
 SELECT 1 AS client_id, 'foo' AS v1, 'bar' AS v2 UNION ALL
 SELECT 2 AS client_id, 'bla' AS v1, 'baz' AS v2 UNION ALL
 SELECT 3 AS client_id, 'bla' AS v1, 'bar' AS v2 UNION ALL
 SELECT 2 AS client_id, 'bla' AS v1, 'baz' AS v2 UNION ALL
 SELECT 3 AS client_id, 'bla' AS v1, 'bar' AS v2
)

SELECT * FROM test
</code></pre>
<p><strong>Convert a semantic version string to a sortable array field</strong></p>
<pre><code class="language-sql">WITH foo AS (
 SELECT '1.0.1' AS v UNION
 SELECT '1.10.3' AS v UNION
 SELECT '1.0.2' AS v UNION
 SELECT '1.1' AS v UNION
 -- Doesn't work with these type of strings due to casting
 -- SELECT '1.3a1' AS v UNION
 SELECT '1.2.1' AS v
)

SELECT cast(split(v, '.') AS array&lt;bigint&gt;) FROM foo ORDER BY 1
</code></pre>
<p><strong>How do boolean fields get parsed from strings?</strong></p>
<pre><code class="language-sql">WITH bar AS (
 SELECT '1' AS b UNION
 SELECT '0' UNION
 SELECT 't' UNION
 SELECT 'f' UNION
 SELECT 'true' UNION
 SELECT 'false' UNION
 SELECT 'turkey'
)
SELECT b, try(cast(b AS boolean)) from bar
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../concepts/choosing_a_dataset.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../concepts/analysis_gotchas.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../concepts/choosing_a_dataset.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../concepts/analysis_gotchas.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../mermaid.min.js"></script>
        
        <script type="text/javascript" src="../mermaid-init.js"></script>
        

        

    </body>
</html>

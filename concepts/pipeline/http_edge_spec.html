
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>HTTP Edge Server Specification Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="event_pipeline.html" />
    
    
    <link rel="prev" href="data_pipeline_detail.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Firefox Data Documentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../reporting_a_problem.html">
            
                <a href="../reporting_a_problem.html">
            
                    
                    Reporting a problem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../terminology.html">
            
                <a href="../terminology.html">
            
                    
                    Terminology
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../getting_started.html">
            
                <a href="../getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../analysis_intro.html">
            
                <a href="../analysis_intro.html">
            
                    
                    Analysis Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../choosing_a_dataset.html">
            
                <a href="../choosing_a_dataset.html">
            
                    
                    Choosing a Dataset
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../tools/stmo.html">
            
                <a href="../../tools/stmo.html">
            
                    
                    Intro to STMO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../analysis_gotchas.html">
            
                <a href="../analysis_gotchas.html">
            
                    
                    Common Analysis Gotchas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../sql_optimization.html">
            
                <a href="../sql_optimization.html">
            
                    
                    Optimizing Queries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../review.html">
            
                <a href="../review.html">
            
                    
                    Getting Review
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../datasets/new_data.html">
            
                <a href="../../datasets/new_data.html">
            
                    
                    Collecting New Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../tools/">
            
                <a href="../../tools/">
            
                    
                    Tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../tools/projects.html">
            
                <a href="../../tools/projects.html">
            
                    
                    Project Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="data_pipeline.html">
            
                <a href="data_pipeline.html">
            
                    
                    Overview of Mozilla's Data Pipeline
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="data_pipeline_detail.html">
            
                <a href="data_pipeline_detail.html">
            
                    
                    In-depth Data Pipeline Detail
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.2.2" data-path="http_edge_spec.html">
            
                <a href="http_edge_spec.html">
            
                    
                    HTTP Edge Server Specification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="event_pipeline.html">
            
                <a href="event_pipeline.html">
            
                    
                    Event Pipeline Detail
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../tools/interfaces.html">
            
                <a href="../../tools/interfaces.html">
            
                    
                    Analysis Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../../tools/spark.html">
            
                <a href="../../tools/spark.html">
            
                    
                    Custom analysis with Spark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../sql_style.html">
            
                <a href="../sql_style.html">
            
                    
                    SQL Style Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" >
            
                <span>
            
                    
                    Experimenting with Shield
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="../../experiments/shield_intro.html">
            
                <a href="../../experiments/shield_intro.html">
            
                    
                    Introduction to Shield
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../experiments/shield_intro.html">
            
                <a href="../../experiments/shield_intro.html">
            
                    
                    Experimenting and Evidence (Shield Program)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../experiments/shield_intro.html">
            
                <a href="../../experiments/shield_intro.html">
            
                    
                    Get Started With Shield
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../experiments/shield_help.html">
            
                <a href="../../experiments/shield_help.html">
            
                    
                    Getting Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../experiments/shield_design_process.html">
            
                <a href="../../experiments/shield_design_process.html">
            
                    
                    Designs for Gathering Evidence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../experiments/shield_surveys.html">
            
                <a href="../../experiments/shield_surveys.html">
            
                    
                    Attitudinal Research:  Heartbeat, Surveys, Panels Screenshots, and Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../experiments/shield_deploy.html">
            
                <a href="../../experiments/shield_deploy.html">
            
                    
                    Shield Deploy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" >
            
                <span>
            
                    
                    Technical Details
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.6.1" >
            
                <a target="_blank" href="https://mana.mozilla.org/wiki/display/strategyandinsights/Shield">
            
                    
                    Mana: Detailed Shield Internal Processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.2" data-path="../../experiments/targeting.html">
            
                <a href="../../experiments/targeting.html">
            
                    
                    Targeting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.3" >
            
                <a target="_blank" href="https://github.com/mozilla/shield-studies-addon-utils/tree/master/docs">
            
                    
                    Shield Study (Addon) Engineering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.4" data-path="../../datasets/shield.html">
            
                <a href="../../datasets/shield.html">
            
                    
                    Telemetry: shield-study, shield-study-addon
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../cookbooks/">
            
                <a href="../../cookbooks/">
            
                    
                    Cookbooks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../tools/alerts.html">
            
                <a href="../../tools/alerts.html">
            
                    
                    Alerts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../cookbooks/parquet.html">
            
                <a href="../../cookbooks/parquet.html">
            
                    
                    Working with Parquet Data on ATMO Clusters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../cookbooks/create_a_dataset.html">
            
                <a href="../../cookbooks/create_a_dataset.html">
            
                    
                    Creating a custom Re:dash dataset
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../../cookbooks/new_ping.html">
            
                <a href="../../cookbooks/new_ping.html">
            
                    
                    Sending a Custom Ping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../../cookbooks/hll_zeppelin.html">
            
                <a href="../../cookbooks/hll_zeppelin.html">
            
                    
                    Using HyperLogLog in Zeppelin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" >
            
                <span>
            
                    
                    Dataset Specific
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../../cookbooks/longitudinal_examples.html">
            
                <a href="../../cookbooks/longitudinal_examples.html">
            
                    
                    Longitudinal Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../../cookbooks/crash_pings.html">
            
                <a href="../../cookbooks/crash_pings.html">
            
                    
                    Working with Crash Pings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" >
            
                <span>
            
                    
                    Real-time
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.1" data-path="../../cookbooks/realtime_analysis_plugin.html">
            
                <a href="../../cookbooks/realtime_analysis_plugin.html">
            
                    
                    Creating a Real-time Analysis Plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.2" data-path="../../cookbooks/view_pings_cep.html">
            
                <a href="../../cookbooks/view_pings_cep.html">
            
                    
                    Seeing Your Own Pings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3" data-path="../../tools/cep_matcher.html">
            
                <a href="../../tools/cep_matcher.html">
            
                    
                    CEP Matcher
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.8" >
            
                <span>
            
                    
                    Metrics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.8.1" data-path="../../cookbooks/active_dau.html">
            
                <a href="../../cookbooks/active_dau.html">
            
                    
                    Active DAU Definition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.2" data-path="../../cookbooks/retention.html">
            
                <a href="../../cookbooks/retention.html">
            
                    
                    Retention Analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../datasets/reference.html">
            
                <a href="../../datasets/reference.html">
            
                    
                    Dataset Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../datasets/pings.html">
            
                <a href="../../datasets/pings.html">
            
                    
                    Pings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../../datasets/derived.html">
            
                <a href="../../datasets/derived.html">
            
                    
                    Derived Datasets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.2.1" data-path="../../datasets/batch_view/addons/reference.html">
            
                <a href="../../datasets/batch_view/addons/reference.html">
            
                    
                    Addons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.2" data-path="../../datasets/mozetl/churn/reference.html">
            
                <a href="../../datasets/mozetl/churn/reference.html">
            
                    
                    Churn
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.3" data-path="../../datasets/batch_view/client_count_daily/reference.html">
            
                <a href="../../datasets/batch_view/client_count_daily/reference.html">
            
                    
                    Client Count Daily
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.4" data-path="../../datasets/batch_view/client_count/reference.html">
            
                <a href="../../datasets/batch_view/client_count/reference.html">
            
                    
                    Client Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.5" data-path="../../datasets/batch_view/clients_daily/reference.html">
            
                <a href="../../datasets/batch_view/clients_daily/reference.html">
            
                    
                    Clients Daily
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.6" data-path="../../datasets/batch_view/crash_aggregates/reference.html">
            
                <a href="../../datasets/batch_view/crash_aggregates/reference.html">
            
                    
                    Crash Aggregate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.7" data-path="../../datasets/batch_view/crash_summary/reference.html">
            
                <a href="../../datasets/batch_view/crash_summary/reference.html">
            
                    
                    Crash Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.8" data-path="../../datasets/batch_view/cross_sectional/reference.html">
            
                <a href="../../datasets/batch_view/cross_sectional/reference.html">
            
                    
                    Cross Sectional
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.9" data-path="../../datasets/streaming/error_aggregates/reference.html">
            
                <a href="../../datasets/streaming/error_aggregates/reference.html">
            
                    
                    Error Aggregates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.10" data-path="../../datasets/batch_view/events/reference.html">
            
                <a href="../../datasets/batch_view/events/reference.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.11" data-path="../../datasets/batch_view/first_shutdown_summary/reference.html">
            
                <a href="../../datasets/batch_view/first_shutdown_summary/reference.html">
            
                    
                    First Shutdown Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.12" data-path="../../datasets/batch_view/longitudinal/reference.html">
            
                <a href="../../datasets/batch_view/longitudinal/reference.html">
            
                    
                    Longitudinal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.13" data-path="../../datasets/batch_view/main_summary/reference.html">
            
                <a href="../../datasets/batch_view/main_summary/reference.html">
            
                    
                    Main Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.14" data-path="../../datasets/batch_view/new_profile/reference.html">
            
                <a href="../../datasets/batch_view/new_profile/reference.html">
            
                    
                    New Profile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.15" data-path="../../datasets/batch_view/retention/reference.html">
            
                <a href="../../datasets/batch_view/retention/reference.html">
            
                    
                    Retention
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.16" data-path="../../datasets/other/socorro_crash/reference.html">
            
                <a href="../../datasets/other/socorro_crash/reference.html">
            
                    
                    Socorro Crash Reports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.17" data-path="../../datasets/other/ssl/reference.html">
            
                <a href="../../datasets/other/ssl/reference.html">
            
                    
                    SSL Ratios (public)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.18" data-path="../../datasets/batch_view/sync_summary/reference.html">
            
                <a href="../../datasets/batch_view/sync_summary/reference.html">
            
                    
                    Sync Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.19" data-path="../../datasets/batch_view/update/reference.html">
            
                <a href="../../datasets/batch_view/update/reference.html">
            
                    
                    Update
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../../tools/experiments.html">
            
                <a href="../../tools/experiments.html">
            
                    
                    Experimental Datasets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="../../datasets/shield.html">
            
                <a href="../../datasets/shield.html">
            
                    
                    Accessing Shield Study data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../../datasets/search.html">
            
                <a href="../../datasets/search.html">
            
                    
                    Search Datasets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.4.1" data-path="../../datasets/mozetl/search_aggregates/reference.html">
            
                <a href="../../datasets/mozetl/search_aggregates/reference.html">
            
                    
                    Search Aggregates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.2" data-path="../../datasets/mozetl/search_clients_daily/reference.html">
            
                <a href="../../datasets/mozetl/search_clients_daily/reference.html">
            
                    
                    Search Clients Daily
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../../datasets/other.html">
            
                <a href="../../datasets/other.html">
            
                    
                    Other Datasets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.5.1" data-path="../../datasets/other/hgpush/reference.html">
            
                <a href="../../datasets/other/hgpush/reference.html">
            
                    
                    hgpush
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="../../datasets/obsolete.html">
            
                <a href="../../datasets/obsolete.html">
            
                    
                    Obsolete Datasets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.6.1" data-path="../../datasets/obsolete/heavy_users/reference.html">
            
                <a href="../../datasets/obsolete/heavy_users/reference.html">
            
                    
                    Heavy Users
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    About this Documentation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../meta/contributing.html">
            
                <a href="../../meta/contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" >
            
                <a target="_blank" href="https://bugzilla.mozilla.org/enter_bug.cgi?assigned_to=nobody%40mozilla.org&bug_file_loc=http%3A%2F%2F&bug_ignored=0&bug_severity=normal&bug_status=NEW&cf_fx_iteration=---&cf_fx_points=---&component=Documentation%20and%20Knowledge%20Repo%20%28RTMO%29&contenttypemethod=autodetect&contenttypeselection=text%2Fplain&defined_groups=1&flag_type-4=X&flag_type-607=X&flag_type-800=X&flag_type-803=X&flag_type-916=X&form_name=enter_bug&maketemplate=Remember%20values%20as%20bookmarkable%20template&op_sys=Linux&priority=--&product=Data%20Platform%20and%20Tools&rep_platform=x86_64&target_milestone=---&version=unspecified">
            
                    
                    Bug Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../meta/structure.html">
            
                <a href="../../meta/structure.html">
            
                    
                    Structure
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >HTTP Edge Server Specification</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="http-edge-server-specification"><a name="http-edge-server-specification" class="plugin-anchor" href="#http-edge-server-specification"><i class="fa fa-link" aria-hidden="true"></i></a>HTTP Edge Server Specification</h1>
<p>This document specifies the behavior of the server that accepts submissions from
any HTTP client e.g. Firefox telemetry.</p>
<p>The original implementation of the HTTP Edge Server was tracked in
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1129222" target="_blank">Bug 1129222</a>.</p>
<h2 id="general-data-flow"><a name="general-data-flow" class="plugin-anchor" href="#general-data-flow"><i class="fa fa-link" aria-hidden="true"></i></a>General Data Flow</h2>
<p>HTTP submissions come in from the wild, hit a load balancer, then optionally an
Nginx proxy, then the HTTP Edge Server described in this document. Data is
accepted via a POST/PUT request from clients, which the server will wrap in a
<a href="http://mozilla-services.github.io/lua_sandbox/heka/message.html" target="_blank">Heka message</a>
and forward to two places: the <a href="data_pipeline.html">Services Data Pipeline</a>, where
any further processing, analysis, and storage will be handled; as well as to a
short-lived S3 bucket which will act as a fail-safe in case there is a
processing error and/or data loss within the main Data Pipeline.</p>
<h3 id="namespaces"><a name="namespaces" class="plugin-anchor" href="#namespaces"><i class="fa fa-link" aria-hidden="true"></i></a>Namespaces</h3>
<p>Namespaces are used to control the processing of data from different types of
clients, from the metadata that is collected to the destinations where the data
is written, processed and accessible. Namespaces are
<a href="https://github.com/mozilla-services/nginx_moz_ingest#example-configuration" target="_blank">configured</a>
in Nginx using a location directive, to request a new namespace file a bug
against the <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Data%20Platform%20and%20Tools&amp;component=Pipeline%20Ingestion" target="_blank">Data Platform Team</a>
with a short description of what the namespace will be used for and the desired
configuration options. Data sent to a namespace that is not specifically
configured is assumed to be in the <a href="../../cookbooks/new_ping.html">non-Telemetry JSON format described here</a>.</p>
<h3 id="forwarding-to-the-pipeline"><a name="forwarding-to-the-pipeline" class="plugin-anchor" href="#forwarding-to-the-pipeline"><i class="fa fa-link" aria-hidden="true"></i></a>Forwarding to the pipeline</h3>
<p>The constructed Heka protobuf message to is written to disk and the pub/sub
pipeline (currently Kafka). The messages written to disk serve as a fail-safe,
they are batched and written to S3 (landfill) when they reach a certain size or
timeout.</p>
<h4 id="edge-server-heka-message-schema"><a name="edge-server-heka-message-schema" class="plugin-anchor" href="#edge-server-heka-message-schema"><i class="fa fa-link" aria-hidden="true"></i></a>Edge Server Heka Message Schema</h4>
<ul>
<li>required binary <strong><code>Uuid</code></strong>;                   // Internal identifier randomly generated</li>
<li>required int64  <strong><code>Timestamp</code></strong>;              // Submission time (server clock)</li>
<li>required string <strong><code>Hostname</code></strong>;               // Hostname of the edge server e.g. <code>ip-172-31-2-68</code></li>
<li>required string <strong><code>Type</code></strong>;                   // Kafka topic name e.g. <code>telemetry-raw</code></li>
<li>required group  <strong><code>Fields</code></strong><ul>
<li>required string <strong><code>uri</code></strong>;                 // Submission URI e.g. <code>/submit/telemetry/6c49ec73-4350-45a0-9c8a-6c8f5aded0cf/main/Firefox/58.0.2/release/20180206200532</code></li>
<li>required binary <strong><code>content</code></strong>;             // POST Body</li>
<li>required string <strong><code>protocol</code></strong>;            // e.g. <code>HTTP/1.1</code></li>
<li>optional string <strong><code>args</code></strong>;                // Query parameters e.g. <code>v=4</code></li>
<li>optional string <strong><code>remote_addr</code></strong>;         // In our setup it is usually a load balancer e.g. <code>172.31.32.229</code></li>
<li>// HTTP Headers specified in the <a href="https://github.com/mozilla-services/puppet-config/blob/06ec0beae535184cc7455c3c2c32b6571160196d/pipeline/modules/pipeline/templates/edge/nginx.conf.erb#L24" target="_blank">production edge server configuration</a></li>
<li>optional string <strong><code>Content-Length</code></strong>;      // e.g. <code>4722</code></li>
<li>optional string <strong><code>Date</code></strong>;                // e.g. <code>Mon, 12 Mar 2018 00:02:18 GMT</code></li>
<li>optional string <strong><code>DNT</code></strong>;                 // e.g. <code>1</code></li>
<li>optional string <strong><code>Host</code></strong>;                // e.g. <code>incoming.telemetry.mozilla.org</code></li>
<li>optional string <strong><code>User-Agent</code></strong>;          // e.g. <code>pingsender/1.0</code></li>
<li>optional string <strong><code>X-Forwarded-For</code></strong>;     // Last entry is treated as the client IP for geoIP lookup e.g. <code>10.98.132.74, 103.3.237.12</code></li>
<li>optional string <strong><code>X-PingSender-Version</code></strong>;// e.g. <code>1.0</code></li>
</ul>
</li>
</ul>
<h2 id="server-requestresponse"><a name="server-requestresponse" class="plugin-anchor" href="#server-requestresponse"><i class="fa fa-link" aria-hidden="true"></i></a>Server Request/Response</h2>
<h3 id="get-request"><a name="get-request" class="plugin-anchor" href="#get-request"><i class="fa fa-link" aria-hidden="true"></i></a>GET Request</h3>
<p>Accept GET on <code>/status</code>, returning <code>OK</code> if all is well. This can be used to
check the health of web servers.</p>
<h3 id="get-response-codes"><a name="get-response-codes" class="plugin-anchor" href="#get-response-codes"><i class="fa fa-link" aria-hidden="true"></i></a>GET Response codes</h3>
<ul>
<li><em>200</em> - OK. <code>/status</code> and all&#x2019;s well</li>
<li><em>404</em> - Any GET other than <code>/status</code></li>
<li><em>500</em> - All is not well</li>
</ul>
<h3 id="postput-request"><a name="postput-request" class="plugin-anchor" href="#postput-request"><i class="fa fa-link" aria-hidden="true"></i></a>POST/PUT Request</h3>
<p>Treat POST and PUT the same. Accept POST or PUT to URLs of the form</p>
<p><code>^/submit/namespace/[id[/dimensions]]$</code></p>
<p>Example Telemetry format:</p>
<p><code>/submit/telemetry/docId/docType/appName/appVersion/appUpdateChannel/appBuildID</code></p>
<p>Specific Telemetry example:</p>
<p><code>/submit/telemetry/ce39b608-f595-4c69-b6a6-f7a436604648/main/Firefox/61.0a1/nightly/20180328030202</code></p>
<p>Example non-Telemetry format:</p>
<p><code>/submit/namespace/doctype/docversion/docid</code></p>
<p>Specific non-Telemetry example:</p>
<p><code>/submit/eng-workflow/hgpush/1/2c3a0767-d84a-4d02-8a92-fa54a3376049</code></p>
<p>Note that <code>id</code> above is a unique document ID, which is used for de-duping
submissions. This is <em>not</em> intended to be the <code>clientId</code> field from Telemetry.
If <code>id</code> is omitted, we will not be able to de-dupe based on submission URLs. It
is recommended that <code>id</code> be a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank">UUID</a>.</p>
<h3 id="postput-response-codes"><a name="postput-response-codes" class="plugin-anchor" href="#postput-response-codes"><i class="fa fa-link" aria-hidden="true"></i></a>POST/PUT Response codes</h3>
<ul>
<li><em>200</em> - OK. Request accepted into the pipeline.</li>
<li><em>400</em> - Bad request, for example an un-encoded space in the URL.</li>
<li><em>404</em> - not found - POST/PUT to an unknown namespace</li>
<li><em>405</em> - wrong request type (anything other than POST/PUT)</li>
<li><em>411</em> - missing content-length header</li>
<li><em>413</em> - request body too large (Note that if we have badly-behaved clients that retry on <code>4XX</code>, we should send back 202 on body/path too long).</li>
<li><em>414</em> - request path too long (See above)</li>
<li><em>500</em> - internal error</li>
</ul>
<h2 id="other-considerations"><a name="other-considerations" class="plugin-anchor" href="#other-considerations"><i class="fa fa-link" aria-hidden="true"></i></a>Other Considerations</h2>
<h3 id="compression"><a name="compression" class="plugin-anchor" href="#compression"><i class="fa fa-link" aria-hidden="true"></i></a>Compression</h3>
<p>It is not desirable to do decompression on the edge node. We want to pass along
messages from the HTTP Edge node without &quot;cracking the egg&quot; of the payload.</p>
<p>We may also receive badly formed payloads, and we will want to track the
incidence of such things within the main pipeline.</p>
<h3 id="bad-messages"><a name="bad-messages" class="plugin-anchor" href="#bad-messages"><i class="fa fa-link" aria-hidden="true"></i></a>Bad Messages</h3>
<p>Since the actual message is not examined by the edge server the only failures
that occur are defined by the response status codes above. Messages are only
forwarded to the pipeline when a response code of 200 is returned to the client.</p>
<h3 id="geoip-lookups"><a name="geoip-lookups" class="plugin-anchor" href="#geoip-lookups"><i class="fa fa-link" aria-hidden="true"></i></a>GeoIP Lookups</h3>
<p>No GeoIP lookup is performed by the edge server. If a client IP is available the
the data warehouse loader performs the lookup and then discards the IP before
the message hits long-term storage.</p>
<h3 id="data-retention"><a name="data-retention" class="plugin-anchor" href="#data-retention"><i class="fa fa-link" aria-hidden="true"></i></a>Data Retention</h3>
<p>The edge server only stores data while batching and will have a retention time
of <code>moz_ingest_landfill_roll_timeout</code> which is generally only a few minutes.
Retention time for the S3 landfill, pub/sub, and the data warehouse is outside
the scope of this document.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="data_pipeline_detail.html" class="navigation navigation-prev " aria-label="Previous page: In-depth Data Pipeline Detail">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="event_pipeline.html" class="navigation navigation-next " aria-label="Next page: Event Pipeline Detail">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"HTTP Edge Server Specification","level":"1.3.2.2","depth":3,"next":{"title":"Event Pipeline Detail","level":"1.3.2.3","depth":3,"path":"concepts/pipeline/event_pipeline.md","ref":"concepts/pipeline/event_pipeline.md","articles":[]},"previous":{"title":"In-depth Data Pipeline Detail","level":"1.3.2.1","depth":3,"path":"concepts/pipeline/data_pipeline_detail.md","ref":"concepts/pipeline/data_pipeline_detail.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["toc","anchors","ga","mermaid-gb3","-fontsettings"],"pluginsConfig":{"toc":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"highlight":{},"mermaid-gb3":{},"ga":{"configuration":"auto","token":"UA-104326577-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"structure":{"langs":"LANGS.md","readme":"introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"concepts/pipeline/http_edge_spec.md","mtime":"2018-08-17T21:53:51.953Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2018-09-06T21:20:40.718Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mermaid-gb3/book/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    <script src="../../gitbook/gitbook-plugin-mermaid-gb3/mermaid/mermaid.min.js"></script>

    </body>
</html>

